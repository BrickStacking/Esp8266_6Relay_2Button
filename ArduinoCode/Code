/* Includes ------------------------------------------------------------------*/
#include <ESP8266WiFi.h>
#include <BlynkSimpleEsp8266.h>
/* Private typedef -----------------------------------------------------------*/
#define BLYNK_PRINT Serial
/* Private variables ---------------------------------------------------------*/
char auth[] = "75ca160b7a4b43a8b5e200e556afcad1";
// Your WiFi credentials.
// Set password to "" for open networks.
char ssid[] = "StackingBrick";
char pass[] = "1234554320";
unsigned long int time1;
int a, b, c, d;
const int button1 = 2;
const int button2 = 0;
const int button3 = 4;
const int button4 = 5;
int x, y, z;
/* Variables Use for shift-out74HC595---------------------------------------------------------*/
bool value1, value2, value3, value4, value5, value6 ;
int value;
int latchPin = 14;
//ch칙n SH_CP(11) c敲브 74HC595
int clockPin = 12;
//Ch칙n DS (14)c敲브 74HC595
int dataPin = 16;
/* Private function prototypes -----------------------------------------------*/
void xulynutnhan(void);
void shiftout_74hc595(void);
void button_processing();
WidgetLCD lcd(V5);
/* Blynk function prototypes -----------------------------------------------*/
BLYNK_WRITE(V0)
{
  if (param.asInt() == 0) {
    value1 = 0;
  }
  else
    value1 = 1;
  // process received value
}
BLYNK_WRITE(V1)
{
  if (param.asInt() == 0)
    value2 = 0;
  else
    value2 = 1;
  // process received value
}
BLYNK_WRITE(V2)
{
  if (param.asInt() == 0)
    value3 = 0;
  else
    value3 = 1;
  // process received value
}
BLYNK_WRITE(V3)
{
  if (param.asInt() == 0)
    value4 = 0;
  else
    value4 = 1;
  // process received value
}

BLYNK_WRITE(V4)
{
  if (param.asInt() == 0)
    value5 = 0;
  else
    value5 = 1;
  // process received value
}

BLYNK_WRITE(V5)
{
  if (param.asInt() == 0)
    value6 = 0;
  else
    value6 = 1;
  // process received value
}

void setup() {
  // put your setup code here, to run once:
  Serial.begin(115200);
  Blynk.begin(auth, ssid, pass, "gith.cf", 8442);
  pinMode(latchPin , OUTPUT);
  pinMode(clockPin, OUTPUT);
  pinMode(dataPin, OUTPUT);
  pinMode(0, INPUT_PULLUP);
  pinMode(2, INPUT_PULLUP);
  //  pinMode(4, INPUT_PULLUP);
  //  pinMode(5, INPUT_PULLUP);
  digitalWrite(latchPin, LOW);
  shiftOut(dataPin, clockPin, MSBFIRST, 0);
  digitalWrite(latchPin, HIGH);
  delay(1000);
  lcd.clear(); //Use it to clear the LCD Widget
  lcd.print(1, 0, "LamChuCongNghe");
  lcd.print(4, 1, "Welcome !"); // use: (position X: 0-15, position Y: 0-1, "Message you want to print")
  time1 = millis();
}

void loop() {
  // put your main code here, to run repeatedly:
  Blynk.run();
  button_processing();
  shiftout_74hc595();
  //blynk_response();
  if ( (millis() - time1) > 1000 ) {
    Serial.print("Value1:");
    Serial.print(value1);
    Serial.print("   ");
    Serial.print("Value2:");
    Serial.print(value2);
    Serial.print("   ");
    Serial.print("   ");
    Serial.print("Value3:");
    Serial.print(value3);
    Serial.print("   ");
    Serial.print("Value4:");
    Serial.print(value4);
    Serial.print("   ");
    Serial.print("Value:");
    Serial.print(value);
    Serial.print("   ");
    Serial.print("X:");
    Serial.print(x);
    Serial.print("   ");
    Serial.print("Y:");
    Serial.print(y);
    Serial.print("   ");
    Serial.print("Z:");
    Serial.print(z);
    Serial.println("   ");

    time1 = millis();

  }
}


void button_processing() {
  /*-----------------*/ // Relay and button 1
  if (digitalRead(button1) == 1)
    a = 0;
  if (digitalRead(button1) == 0)
    a++;
  if (a == 10 ) {
    value1 = !value1;
    Blynk.virtualWrite(V1, value1);
  }

  //////////

  /*-----------------*/ // Relay and button 2
  if (digitalRead(button2) == 1)
    b = 0;
  if (digitalRead(button2) == 0)
    b++;
  if (b == 10 ) {
    value2 = !value2;
    Blynk.virtualWrite(V2, value2);
  }
  //////////

  //  /*-----------------*/ // Relay and button 3
  //  if (digitalRead(button3) == 1)
  //    c = 0;
  //  if (digitalRead(button3) == 0)
  //    c++;
  //  if (c == 10 ) {
  //    value3 = !value3;
  //    Blynk.virtualWrite(V3, value3);
  //  }
  //
  //  //////////
  //
  //  /*-----------------*/ // Relay and button 4
  //  if (digitalRead(button4) == 1)
  //    d = 0;
  //  if (digitalRead(button4) == 0)
  //    d++;
  //  if (d == 10 ) {
  //    value4 = !value4;
  //    Blynk.virtualWrite(V4, value4);
  //  }

}

void shiftout_74hc595(void) {
  value = value1 * 2 + value2 * 4 + value3 * 8 + value4 * 16 + value5 * 32 + value6 * 64;
  digitalWrite(latchPin, LOW);
  shiftOut(dataPin, clockPin, MSBFIRST, value);
  //shiftOut(dataPin, clockPin, MSBFIRST, so1[mode1]);
  digitalWrite(latchPin, HIGH);
}

void blynk_response() {


}
